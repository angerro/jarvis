# Jarvis
`Jarvis` - это приложение для запуска команд c отображением результата в консоли или браузере.

# Содержимое

- [Создание команды](#создание-команды)
  - [Метод configure](#метод-configure)
  - [Аргументы и опции](#аргументы-и-опции)
  - [Определение аргументов и опций](#определение-аргументов-и-опций)
  - [Метод execute](#метод-execute)
  - [Регистрация команды](#регистрация-команды)
- [Запуск команды в консоли](#запуск-команды-в-консоли)
- [Запуск команды в php коде](#запуск-команды-в-php-коде)
- [Вывод информации](#вывод-информации)
- [Справочная команда help](#справочная-команда-help)

## Создание команды

Команды определяются в классах, расширяющих AbstractCommand. 

Например, вы можете захотеть, чтобы команда выводила информацию о человеке.

Для этого необходимо в директории Commands создать класс Example, который унаследован от AbstractCommand.

`namespace` класса должен соответствовать той директории, где этот класс располагается: `Jarvis\Commands`

```
<?php

namespace Jarvis\Commands;

use Jarvis\Vendor\Command\AbstractCommand;

class Example extends AbstractCommand
{
    
}
```

Далее необходимо реализовать публичный метод `configure` в котором определяется название команды, ее описание, а также аргументы и опции.

### Метод configure

Для начала определим имя команды и её описание:
```
<?php

namespace Jarvis\Commands;

use Jarvis\Vendor\Command\AbstractCommand;

class Example extends AbstractCommand
{
    public function configure()
    {
        $this->setName('example')
             ->setDescription('Команда для демонстрации работы консольного приложения Jarvis');
    }
}
```
Как вы можете заметить, название команды устанавливается с помощью встроенного метода `setName`, 
а описание - `setDescription`.

Хотя бы какое-то название команды обязательно нужно указать, иначе будет непонятно какому названию команды 
соответствует наш класс.

Указание же описания команды необязательно, но желательно.

### Аргументы и опции

Аргумент - это неименованный параметр команды для которого важен порядок его указания в команде.

Опция - это именованный параметр команды. При запуске команды из консоли опция пишется с префиксом в виде двух дефисов.

К примеру, в команде
```
php jarvis example arg1 arg2 arg3 --option1 --option2=value1 --option2=value2
```
аргументами являются параметры arg1, arg2, arg3, а опциями option1 и option2.

Опции отличаются от аргументов тем, что:
- порядок их указания в команде неважен: 
```
--option1 --option2
```
или
```
--option2 --option1
```
не изменяет самого факта указания опций option1 и option2.
- могут как иметь значения, так и не иметь:
```
--option1 --option2=value1
```
здесь option1 не имеет значения, а option2 - имеет значение равное value1
- могут хранить в себе множество значений
```
--option2=value1 --option2=value2
``` 
здесь option2 имеет два значения: value1 и value2

### Определение аргументов и опций

Аргументы определяются с помощью метода `addArgument`.

Этот метод имеет следующие параметры:
- название аргумента
- описание аргумента
- обязательность

Опции определяются с помощью метода `addOption`.

Этот метод имеет следующие параметры:
- название опции
- описание опции
- обязательность указания значения

Определим аргументы и опции в методе configure для реализации нашей задумки:
```
<?php

namespace Jarvis\Commands;

use Jarvis\Vendor\Command\AbstractCommand;

class Example extends AbstractCommand
{
    public function configure()
    {
        $this->setName('example')
             ->setDescription('Команда для демонстрации работы консольного приложения Jarvis')
             ->addArgument('name', 'имя')
             ->addArgument('surname', 'фамилия', false)
             ->addArgument('second-name', 'отчество', false)
             ->addOption('excellence', 'положительные качества', true)
             ->addOption('job', 'есть работа');
    }
}
```
Получать информацию о человеке мы будем из аргументов и опций.
Здесь определены следующие аргументы:
- имя (обязательное)
- фамилия (необязательное)
- отчество (необязательное)

И опции:
- положительные качества (каждое должно иметь значение)
- есть работа (значение необязательно)

### Метод execute
Осталось сделать метод execute, который будет реализовывать логику команды на основе введённых аргументов и опций.

Этот метод принимает на вход экземпляр наследника класса AbstractOutput с помощью которого осуществляется вывод
информации в консоль/браузер.

Реализуем его:
```
<?php

namespace Jarvis\Commands;

use Jarvis\Vendor\Command\AbstractCommand;
use Jarvis\Vendor\Output\AbstractOutput;

class Example extends AbstractCommand
{
    public function configure()
    {
        $this->setName('example')
             ->setDescription('Команда для демонстрации работы консольного приложения Jarvis')
             ->addArgument('name', 'имя')
             ->addArgument('surname', 'фамилия', false)
             ->addArgument('second-name', 'отчество', false)
             ->addOption('excellence', 'положительные качества', true)
             ->addOption('job', 'есть работа');
    }

    public function execute(AbstractOutput $output)
    {
        $output->success('Результат выполнения команды:');
        $output->info("Имя: ".$this->getArgument('name'));
        if ($this->hasArgument('surname')){
            $output->info("Фамилия: ".$this->getArgument('surname'));
        }
        if ($this->hasArgument('second-name')){
            $output->info("Отчество: ".$this->getArgument('second-name'));
        }
        if ($this->hasOption('excellence')){
            $output->info("Положительные качества: ". implode(', ', $this->getOption('excellence')));
        }
        if ($this->hasOption('job')){
            $output->info("Работа: есть");
        }
    }
}
```
Здесь вы можете заметить методы:
- `hasArgument`
- `getArgument`
- `hasOption`
- `getOption`

Эти методы нужны для определения присутствия и получения значения аргументов и опций в введённой команде.

### Регистрация команды

Чтобы нашу команду example можно было запустить, необходимо её добавить в конфигурационный файл `config.php` в блок 
`commands`.

Для этого нужно вписать туда её `namespace`.

## Запуск команды в консоли
Попробуем запустить нашу команду:
```
php jarvis example василий --excellence='веселый парень' --excellence='любит борщ' --job
```
На выходе получим:
```
Результат выполнения команды:
Имя: василий
Положительные качества: веселый парень, любит борщ
Работа: есть
```

## Запуск команды в php коде
Если необходимо запустить команду не из консоли, а прямо в php коде, чтобы результат
выполнения отображался в браузере можно поступить так:
```
<?php

use Jarvis\Vendor\Input\ArrayInput;
use Jarvis\Vendor\Output\Browser;
use Jarvis\Vendor\Application;

try {
    require 'autoloader.php';
    $input = new ArrayInput([
        'command'   => 'example',
        'arguments' => [
            'Василий',
            'Пупкин'
        ],
        'options'   => [
            'excellence' => [
                'любит покушать',
                'обожает сериалы',
                'добряк'
            ],
            'job'        => null
        ]
    ]);
    $output = new Browser();
    $app = new Application($input, $output);
    $app->run();
} catch (\Exception $e) {
    (new Browser())->error($e->getMessage());
}
```
Здесь команда, аргументы и опции определяются в массиве, который передаётся в конструктор класса `ArrayInput`.

Название ключей этого массива соответствует тому, что передаётся: команда, аргументы или опции.
Порядок аргументов важен - их нужно задавать в том же порядке, что и из-под консоли.

Результат выполнения:
```
Результат выполнения команды:
Имя: Василий
Фамилия: Пупкин
Положительные качества: любит покушать, обожает сериалы, добряк
Работа: есть
```

## Вывод информации
Вывод информации производится за счет универсального класса-наследника AbstractOutput, любой из которых содержит в себе
следующие методы:
- `info`
- `error`
- `success`
- `warning`

Все эти методы принимают на вход строку и выводят её соответствующим цветом:
- серый (в консоли) / бирюзовый (в браузере)
- красный 
- зеленый
- желтый

Для вывода в консоль используется класс `Console`.

Для вывода в браузер - класс `Browser`.

## Справочная команда help
В Jarvis по умолчанию встроена команда `help`, с помощью которой можно получить информацию о списке зарегистрированных 
команд:
```
php jarvis help
```
либо о какой-то конкретной команде:
```
php jarvis help example
```